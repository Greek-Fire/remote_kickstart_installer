- set_fact:
    os_major: "{{ item['os_major'] }}"
    os_minor: "{{ item['os_minor'] }}"

- name: "create the web path: {{ item['appstream_web_path'] }}"
  file:
    path: "{{ path['appstream_web_path'] }}"
    recurse: true
    state: directory

- name: "create the web path: {{ path['baseos_web_path'] }}"
  file:
    path: "{{ path['baseos_web_path'] }}"
    recurse: true
    state: directory

- name: "copy from iso mount to {{ foreman_server_url }}/pub/***"
  copy:
    remote_src: true
    src:  "{{ path['appstream_copy_path'] }}"
    dest: "{{ path['appstream_web_path'] }}"
    owner: apache
    group: apache

- name: "copy from iso mount to {{ foreman_server_url }}/pub/***"
  copy:
    remote_src: true
    src:  "{{ path['baseos_copy_path'] }}"
    dest: "{{ path['baseos_web_path'] }}"
    owner: apache
    group: apache

- name: generate treeinfo
  template:
    src:  "{{ jinja_path }}"
    dest: "{{ path['appstream_web_path'] }}"
    owner: apache
    group: apache
 when: path['appstream_web_path'] is defined
  vars:
    jinja_path: AppStream.j2

- name: generate treeinfo
  template:
    src:  "{{ jinja_path }}"
    dest: "{{ path['baseos_web_path'] }}"
    owner: apache
    group: apache
  when: path['baseos_web_path'] is defined
  vars:
    jinja_path: BaseOS.j2